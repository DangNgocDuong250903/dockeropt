# Giải thích nút RUN vs DEPLOY

## 🎮 2 Nút trong giao diện http://127.0.0.1:5173/

```
┌──────────────────────────────────────────────────────────────┐
│  script.sh                                                    │
│  ───────────────────────────────────────────────────────     │
│                                     [Deploy]  [Run]           │
└──────────────────────────────────────────────────────────────┘
```

---

## 🚀 **RUN** (Nút màu xanh dương-tím)

### Nghĩa là gì?
**Chạy script NGAY trên máy local** (máy đang chạy web server)

### Hoạt động như thế nào?
```
┌─────────────┐         ┌─────────────┐
│   Browser   │  Click  │ Web Server  │
│             │─────────▶│ (Local PC)  │
│ Click [Run] │         │             │
└─────────────┘         │ Execute     │
                        │ script.sh   │
                        └─────────────┘
                              │
                              ▼
                        ┌─────────────┐
                        │   Result    │
                        │   + Log     │
                        └─────────────┘
```

### Ví dụ:
```powershell
# Bạn click [Run] trên script "test.sh"
# → Web server chạy: bash test.sh
# → Kết quả hiện trong log
# → Tự động chuyển đến trang xem log
```

### Khi nào dùng?
- ✅ Test script nhanh
- ✅ Chạy script trên máy local
- ✅ Script setup/config cho máy hiện tại
- ✅ Scripts không cần deploy lên server

### Lưu ý:
- ⚠️ Script chạy trên máy **local** (Windows/Linux nơi web chạy)
- ⚠️ Cần có môi trường phù hợp (bash, python, powershell...)
- ⚠️ Quyền truy cập là quyền của user chạy web server

---

## 🌐 **DEPLOY** (Nút màu xanh lá)

### Nghĩa là gì?
**Triển khai script lên các VM/Server từ xa** qua SSH

### Hoạt động như thế nào?
```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│   Browser   │  Click  │ Web Server  │   SSH   │  Remote VM  │
│             │─────────▶│ (Local PC)  │─────────▶│ (Server 1)  │
│Click[Deploy]│         │             │         │             │
└─────────────┘         │ 1. Copy     │         │ 2. Receive  │
                        │    script   │         │    script   │
                        │ 2. SSH      │         │ 3. Execute  │
                        │    connect  │         │    (optional)│
                        └─────────────┘         └─────────────┘
                              │                       │
                              ▼                       │
                        ┌─────────────┐               │
                        │ Select VMs  │               │
                        │ - Server 1 ☑│               │
                        │ - Server 2 ☑│───────────────┘
                        │ - Server 3 ☐│
                        │             │
                        │ [Deploy Now]│
                        └─────────────┘
```

### Quy trình chi tiết:
```
1. Click [Deploy] button
   ↓
2. Mở trang Deploy page
   ↓
3. Chọn target VMs (servers)
   ☑ hk-vps-01
   ☑ sg-vps-02
   ☐ us-vps-03
   ↓
4. Cấu hình options:
   - Destination path: /opt/scripts/setup.sh
   - ☑ Execute after deploy
   ↓
5. Click [Deploy to VMs]
   ↓
6. System thực hiện:
   a. Connect SSH đến từng VM
   b. Copy script file qua SFTP
   c. (Optional) Execute script on VM
   d. Show kết quả real-time
```

### Ví dụ thực tế:

#### Ví dụ 1: Deploy và chạy
```
Script: install-xray.sh

Click [Deploy]
→ Chọn: hk-vps-01, sg-vps-02
→ Path: /tmp/install-xray.sh
→ ☑ Execute after deploy
→ Click [Deploy]

Kết quả:
✅ hk-vps-01: Uploaded + Executed (Exit: 0)
✅ sg-vps-02: Uploaded + Executed (Exit: 0)
```

#### Ví dụ 2: Chỉ upload, không chạy
```
Script: config.json

Click [Deploy]
→ Chọn: All VMs
→ Path: /etc/app/config.json
→ ☐ Execute after deploy (uncheck)
→ Click [Deploy]

Kết quả:
✅ hk-vps-01: Uploaded
✅ sg-vps-02: Uploaded
✅ us-vps-03: Uploaded
```

### Khi nào dùng?
- ✅ Deploy script lên nhiều servers
- ✅ Update configuration files
- ✅ Batch deployment
- ✅ Setup scripts cho VPS mới
- ✅ Update/patch scripts trên production

### Lưu ý:
- ⚠️ Cần configure VMs trước (trong VM Manager)
- ⚠️ Cần SSH keys hoặc password
- ⚠️ Script chạy trên **remote server** (không phải local)
- ⚠️ Có thể deploy song song nhiều VMs (parallel)

---

## 📊 So sánh RUN vs DEPLOY

| Tiêu chí | 🚀 RUN | 🌐 DEPLOY |
|----------|--------|-----------|
| **Chạy ở đâu** | Máy local | Server từ xa (VMs) |
| **Kết nối** | Không cần | Cần SSH |
| **Số lượng** | 1 máy (local) | Nhiều VMs |
| **Tốc độ** | Nhanh | Phụ thuộc network |
| **Use case** | Test, local setup | Production deploy |
| **Log** | Local log file | Remote execution log |
| **Quyền hạn** | Local user | Remote SSH user |

---

## 🎯 Workflow thực tế

### Scenario 1: Test → Deploy
```
1. Viết script: setup-xray.sh
2. Click [Run] để test local
3. Xem log, check lỗi
4. Fix bugs
5. Click [Run] lại để test
6. Khi OK → Click [Deploy]
7. Deploy lên production servers
```

### Scenario 2: Mass deployment
```
1. Có 10 VPS cần setup
2. Viết script: auto-setup.sh
3. Test bằng [Run] trên local
4. Click [Deploy]
5. Chọn tất cả 10 VMs
6. Enable "Execute after deploy"
7. Deploy song song (parallel)
8. Xem results real-time
```

### Scenario 3: Config update
```
1. Update file: nginx.conf
2. Không cần [Run] (chỉ là config)
3. Click [Deploy]
4. Chọn web servers
5. Path: /etc/nginx/nginx.conf
6. Uncheck "Execute" (không phải script)
7. Deploy
8. SSH vào restart nginx
```

---

## 💡 Tips & Best Practices

### Khi dùng RUN:
```bash
✅ DO:
- Test scripts trước
- Chạy safe scripts
- Scripts cần output ngay

❌ DON'T:
- Scripts cần root (nếu web chạy user thường)
- Scripts chạy lâu (>5 phút)
- Scripts destructive
```

### Khi dùng DEPLOY:
```bash
✅ DO:
- Test local trước
- Backup trước khi deploy
- Deploy lần lượt từng VM (test nhỏ trước)
- Check SSH connection trước

❌ DON'T:
- Deploy untested scripts
- Deploy to all production cùng lúc
- Forget to check destination path
- Deploy với wrong SSH keys
```

---

## 🔧 Troubleshooting

### RUN fails:
```
Q: Click [Run] nhưng script không chạy?
A: Check:
   - Script có executable permission?
   - Môi trường có đúng? (bash/python installed?)
   - Path có đúng không?
   - Check logs trong /logs
```

### DEPLOY fails:
```
Q: Click [Deploy] nhưng failed?
A: Check:
   - VM có trong config không?
   - SSH connection OK? (test với: vm test server-name)
   - SSH key đúng chưa?
   - Destination path có quyền write?
   - Network/firewall có block?
```

---

## 📝 Tóm tắt

### 🚀 **RUN Button**
```
CÁI NÀY = Chạy script trên máy MÀY (local)
```

### 🌐 **DEPLOY Button**  
```
CÁI NÀY = Gửi script lên SERVER (remote VMs)
```

---

## 🎬 Demo Commands

### Test RUN:
```bash
# 1. Start web server
python auto.py scripts start

# 2. Open browser: http://127.0.0.1:5173/

# 3. Click [Run] on any script

# 4. See logs at: http://127.0.0.1:5173/logs
```

### Test DEPLOY:
```bash
# 1. Add VM first
python auto.py vm quick-add root@your-server.com

# 2. Test connection
python auto.py vm test 1

# 3. Start web server
python auto.py scripts start

# 4. Open: http://127.0.0.1:5173/

# 5. Click [Deploy] on script

# 6. Select VMs → Deploy
```

---

**Hiểu chưa? 😊**

- **RUN** = Chạy local (như double click file)
- **DEPLOY** = Gửi lên server + chạy remote (như scp + ssh)

