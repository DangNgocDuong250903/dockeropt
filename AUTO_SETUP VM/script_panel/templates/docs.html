{% extends "base.html" %}

{% block title %}Documentation - AUTO Project{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent mb-4">
      üìö AUTO Project Documentation
    </h1>
    <p class="text-gray-400 text-lg">
      Complete guide for VM Management, Script Deployment & Automation
    </p>
  </div>

  <!-- Quick Navigation -->
  <div class="glass rounded-xl border border-gray-700 p-6 mb-8">
    <h2 class="text-xl font-bold text-gray-100 mb-4">üéØ Quick Navigation</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <a href="#quickstart" class="px-4 py-3 bg-blue-500/20 border border-blue-500/50 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors text-center">
        <i class="fas fa-rocket mr-2"></i>Quick Start
      </a>
      <a href="#vm-manager" class="px-4 py-3 bg-green-500/20 border border-green-500/50 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-center">
        <i class="fas fa-server mr-2"></i>VM Manager
      </a>
      <a href="#script-panel" class="px-4 py-3 bg-purple-500/20 border border-purple-500/50 text-purple-400 rounded-lg hover:bg-purple-500/30 transition-colors text-center">
        <i class="fas fa-terminal mr-2"></i>Script Panel
      </a>
      <a href="#examples" class="px-4 py-3 bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-colors text-center">
        <i class="fas fa-code mr-2"></i>Examples
      </a>
      <a href="#commands" class="px-4 py-3 bg-red-500/20 border border-red-500/50 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-center">
        <i class="fas fa-list mr-2"></i>Commands
      </a>
      <a href="#troubleshooting" class="px-4 py-3 bg-gray-500/20 border border-gray-500/50 text-gray-400 rounded-lg hover:bg-gray-500/30 transition-colors text-center">
        <i class="fas fa-wrench mr-2"></i>Troubleshooting
      </a>
    </div>
  </div>

  <!-- Quick Start Section -->
  <div id="quickstart" class="glass rounded-xl border border-gray-700 p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-100 mb-6">üöÄ Quick Start (5 minutes)</h2>
    
    <div class="space-y-6">
      <!-- Step 1 -->
      <div class="bg-gray-800/50 rounded-lg p-6 border-l-4 border-blue-500">
        <div class="flex items-center gap-3 mb-4">
          <span class="bg-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">1</span>
          <h3 class="text-xl font-bold text-blue-400">Setup VM Manager</h3>
        </div>
        
        <p class="text-gray-300 mb-4">Install and configure VM SSH Manager:</p>
        
        <div class="tabs mb-4">
          <button onclick="showTab('setup-windows')" class="tab-btn active px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-t-lg transition-colors" data-tab="windows">
            <i class="fab fa-windows mr-2"></i>Windows
          </button>
          <button onclick="showTab('setup-linux')" class="tab-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-t-lg transition-colors" data-tab="linux">
            <i class="fab fa-linux mr-2"></i>Linux/Mac
          </button>
        </div>

        <div id="setup-windows" class="tab-content">
          <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-powershell"># Windows PowerShell
cd E:\AUTO
.\setup-vm-manager.ps1</code></pre>
        </div>

        <div id="setup-linux" class="tab-content hidden">
          <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Linux/Mac
cd ~/AUTO
chmod +x setup-vm-manager.sh
./setup-vm-manager.sh
source ~/.bashrc</code></pre>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="bg-gray-800/50 rounded-lg p-6 border-l-4 border-green-500">
        <div class="flex items-center gap-3 mb-4">
          <span class="bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">2</span>
          <h3 class="text-xl font-bold text-green-400">Add Your First VM</h3>
        </div>
        
        <p class="text-gray-300 mb-4">Use the interactive wizard or quick-add:</p>
        
        <div class="space-y-4">
          <div>
            <p class="text-sm text-gray-400 mb-2">Option 1: Wizard (Easiest - Guided setup)</p>
            <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash">python auto.py vm wizard</code></pre>
          </div>
          
          <div>
            <p class="text-sm text-gray-400 mb-2">Option 2: Quick Add (Fastest)</p>
            <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Format: user@host[:port]
python auto.py vm quick-add root@1.2.3.4
python auto.py vm quick-add ubuntu@server.com:2222</code></pre>
          </div>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="bg-gray-800/50 rounded-lg p-6 border-l-4 border-purple-500">
        <div class="flex items-center gap-3 mb-4">
          <span class="bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">3</span>
          <h3 class="text-xl font-bold text-purple-400">Start Using!</h3>
        </div>
        
        <p class="text-gray-300 mb-4">Connect to VM or start Script Panel:</p>
        
        <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Connect to VM
python auto.py vm connect 1

# Or start web interface
python auto.py scripts start
# Then open: http://127.0.0.1:5173</code></pre>
      </div>
    </div>
  </div>

  <!-- VM Manager Section -->
  <div id="vm-manager" class="glass rounded-xl border border-gray-700 p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-100 mb-6">üñ•Ô∏è VM SSH Manager</h2>
    
    <!-- Key Management -->
    <div class="mb-8">
      <h3 class="text-2xl font-bold text-green-400 mb-4">üîë SSH Key Management</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-gray-200 mb-2">Generate SSH Key</h4>
          <pre class="bg-gray-900 rounded-lg p-3 text-sm overflow-x-auto"><code class="language-bash"># Generate RSA key (default)
vm key generate

# Generate ED25519 (modern)
vm key generate --type ed25519

# Custom name
vm key generate --name my-server</code></pre>
        </div>

        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-gray-200 mb-2">Manage Keys</h4>
          <pre class="bg-gray-900 rounded-lg p-3 text-sm overflow-x-auto"><code class="language-bash"># List all keys
vm key list

# Copy to server
vm key copy id_rsa root@server.com</code></pre>
        </div>
      </div>
    </div>

    <!-- Batch Operations -->
    <div class="mb-8">
      <h3 class="text-2xl font-bold text-blue-400 mb-4">‚ö° Batch Operations</h3>
      
      <div class="space-y-4">
        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-gray-200 mb-2">Execute Commands</h4>
          <pre class="bg-gray-900 rounded-lg p-3 text-sm overflow-x-auto"><code class="language-bash"># Run on all VMs (parallel)
vm batch exec "uptime" --parallel

# Run on specific VMs (pattern matching)
vm batch exec "df -h" --pattern "prod-.*" --parallel

# Sequential execution
vm batch exec "systemctl restart xray"</code></pre>
        </div>

        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-gray-200 mb-2">Deploy Scripts</h4>
          <pre class="bg-gray-900 rounded-lg p-3 text-sm overflow-x-auto"><code class="language-bash"># Deploy and execute
vm batch deploy setup.sh --execute --parallel

# Deploy to specific VMs
vm batch deploy script.sh --pattern "hk-.*" --dest /opt/script.sh

# Deploy with custom path
vm batch deploy config.json --dest /etc/app/config.json</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Examples Section -->
  <div id="examples" class="glass rounded-xl border border-gray-700 p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-100 mb-6">üí° Real-World Examples</h2>
    
    <div class="space-y-6">
      <!-- Example 1 -->
      <div class="bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg p-6 border border-blue-500/30">
        <h3 class="text-xl font-bold text-blue-400 mb-3">
          <i class="fas fa-rocket mr-2"></i>Example 1: Setup New VPS (Complete Workflow)
        </h3>
        <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Step 1: Run wizard
vm wizard
# ‚Üí Answer questions
# ‚Üí Let it generate SSH key
# ‚Üí Copy key to server (enter password once)
# ‚Üí Test connection
# ‚Üí Done!

# Step 2: Connect
vm connect 1

# Step 3: Deploy setup script
vm batch deploy setup-xray.sh --execute</code></pre>
      </div>

      <!-- Example 2 -->
      <div class="bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-6 border border-green-500/30">
        <h3 class="text-xl font-bold text-green-400 mb-3">
          <i class="fas fa-network-wired mr-2"></i>Example 2: Manage Multiple Servers
        </h3>
        <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Generate shared key
vm key generate --name prod-servers

# Copy to all servers
vm key copy prod-servers root@server1.com
vm key copy prod-servers root@server2.com
vm key copy prod-servers root@server3.com

# Quick add all
vm quick-add root@server1.com
vm quick-add root@server2.com
vm quick-add root@server3.com

# Health check on all
vm batch exec "systemctl status xray" --parallel

# Deploy update to all
vm batch deploy update.sh --execute --parallel</code></pre>
      </div>

      <!-- Example 3 -->
      <div class="bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-6 border border-yellow-500/30">
        <h3 class="text-xl font-bold text-yellow-400 mb-3">
          <i class="fas fa-code mr-2"></i>Example 3: Deploy from Web UI
        </h3>
        <pre class="bg-gray-900 rounded-lg p-4 overflow-x-auto border border-gray-700"><code class="language-bash"># Start web interface
python auto.py scripts start

# Then in browser (http://127.0.0.1:5173):
# 1. Browse scripts
# 2. Click "Deploy" button
# 3. Select target VMs
# 4. Configure options
# 5. Click "Deploy to VMs"
# 6. See real-time results!</code></pre>
      </div>
    </div>
  </div>

  <!-- Commands Reference -->
  <div id="commands" class="glass rounded-xl border border-gray-700 p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-100 mb-6">üìã Commands Reference</h2>
    
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="px-4 py-3 text-blue-400">Command</th>
            <th class="px-4 py-3 text-green-400">Description</th>
            <th class="px-4 py-3 text-purple-400">Example</th>
          </tr>
        </thead>
        <tbody class="text-gray-300">
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm wizard</td>
            <td class="px-4 py-3">Interactive setup</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm wizard</td>
          </tr>
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm quick-add</td>
            <td class="px-4 py-3">Quick add VM</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm quick-add root@1.2.3.4</td>
          </tr>
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm list</td>
            <td class="px-4 py-3">List all VMs</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm list</td>
          </tr>
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm connect</td>
            <td class="px-4 py-3">Connect to VM</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm connect server-1</td>
          </tr>
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm key generate</td>
            <td class="px-4 py-3">Generate SSH key</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm key generate --type ed25519</td>
          </tr>
          <tr class="border-b border-gray-800 hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm batch exec</td>
            <td class="px-4 py-3">Execute on multiple VMs</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm batch exec "uptime" -P</td>
          </tr>
          <tr class="hover:bg-gray-800/30">
            <td class="px-4 py-3 font-mono text-sm text-blue-400">vm batch deploy</td>
            <td class="px-4 py-3">Deploy to multiple VMs</td>
            <td class="px-4 py-3 font-mono text-sm text-gray-500">vm batch deploy script.sh -x</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Troubleshooting -->
  <div id="troubleshooting" class="glass rounded-xl border border-gray-700 p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-100 mb-6">üîß Troubleshooting</h2>
    
    <div class="space-y-4">
      <details class="bg-gray-800/50 rounded-lg border border-gray-700">
        <summary class="px-6 py-4 cursor-pointer text-gray-200 font-semibold hover:text-blue-400 transition-colors">
          <i class="fas fa-question-circle mr-2 text-blue-400"></i>Flask module not found
        </summary>
        <div class="px-6 pb-4">
          <pre class="bg-gray-900 rounded-lg p-4 text-sm overflow-x-auto"><code class="language-bash">pip install flask paramiko</code></pre>
        </div>
      </details>

      <details class="bg-gray-800/50 rounded-lg border border-gray-700">
        <summary class="px-6 py-4 cursor-pointer text-gray-200 font-semibold hover:text-blue-400 transition-colors">
          <i class="fas fa-question-circle mr-2 text-blue-400"></i>SSH connection failed
        </summary>
        <div class="px-6 pb-4 space-y-2">
          <pre class="bg-gray-900 rounded-lg p-4 text-sm overflow-x-auto"><code class="language-bash"># Test connection
vm test server-name

# Fix host/port
vm edit server-name --host correct-ip --port 22

# Regenerate key
vm key generate --name new-key
vm key copy new-key root@server</code></pre>
        </div>
      </details>

      <details class="bg-gray-800/50 rounded-lg border border-gray-700">
        <summary class="px-6 py-4 cursor-pointer text-gray-200 font-semibold hover:text-blue-400 transition-colors">
          <i class="fas fa-question-circle mr-2 text-blue-400"></i>ssh-keygen not found (Windows)
        </summary>
        <div class="px-6 pb-4">
          <pre class="bg-gray-900 rounded-lg p-4 text-sm overflow-x-auto"><code class="language-powershell">Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</code></pre>
        </div>
      </details>
    </div>
  </div>

  <!-- Footer -->
  <div class="text-center py-8">
    <p class="text-gray-400 mb-4">Need more help?</p>
    <div class="flex justify-center gap-4">
      <a href="/" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors">
        <i class="fas fa-home mr-2"></i>Back to Home
      </a>
      <a href="https://github.com" target="_blank" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
        <i class="fab fa-github mr-2"></i>GitHub
      </a>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/powershell.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

<script>
// Initialize syntax highlighting
document.addEventListener('DOMContentLoaded', () => {
  hljs.highlightAll();
});

// Tab switching
function showTab(tabId) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.add('hidden');
  });
  
  // Remove active from all buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active', 'bg-blue-500');
    btn.classList.add('bg-gray-700');
  });
  
  // Show selected tab
  document.getElementById(tabId).classList.remove('hidden');
  
  // Mark button as active
  event.target.classList.add('active', 'bg-blue-500');
  event.target.classList.remove('bg-gray-700');
}

// Smooth scroll for navigation
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    if (target) {
      target.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  });
});

// Copy code button
document.querySelectorAll('pre code').forEach((block) => {
  const button = document.createElement('button');
  button.className = 'copy-btn absolute top-2 right-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity';
  button.innerHTML = '<i class="fas fa-copy mr-1"></i>Copy';
  
  const pre = block.parentElement;
  pre.style.position = 'relative';
  pre.classList.add('group');
  pre.appendChild(button);
  
  button.addEventListener('click', () => {
    navigator.clipboard.writeText(block.textContent).then(() => {
      button.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
      button.classList.add('bg-green-600');
      setTimeout(() => {
        button.innerHTML = '<i class="fas fa-copy mr-1"></i>Copy';
        button.classList.remove('bg-green-600');
      }, 2000);
    });
  });
});
</script>

<style>
.tab-btn.active {
  background-color: #3b82f6;
  color: white;
}

details summary::-webkit-details-marker {
  display: none;
}

details summary::marker {
  display: none;
}

details[open] summary {
  color: #60a5fa;
}

/* Syntax highlighting custom theme */
.hljs {
  background: #1a1b26 !important;
  color: #a9b1d6 !important;
}

.hljs-comment {
  color: #565f89 !important;
}

.hljs-keyword {
  color: #bb9af7 !important;
}

.hljs-string {
  color: #9ece6a !important;
}

.hljs-number {
  color: #ff9e64 !important;
}

.hljs-built_in {
  color: #7aa2f7 !important;
}
</style>
{% endblock %}

